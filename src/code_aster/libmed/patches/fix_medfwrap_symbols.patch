Subject: [PATCH] fix medfwrap symbols
---
Index: src/CMakeLists.txt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
--- a/src/CMakeLists.txt	(revision 5a8ca1686bb941ed34018001db7e4d86a3b1bfe7)
+++ b/src/CMakeLists.txt	(date 1713957340468)
@@ -114,7 +114,18 @@
   IF(MEDFILE_BUILD_SHARED_LIBS)
     ## Intermediate library - this is unavoidable 
     ## if we want the Fortran wrapper to build correctly under win.
-    ADD_LIBRARY(medfwrap SHARED ${medfort_wrap_SOURCES})
+    if (MSVC)
+      # Due to issue https://gitlab.kitware.com/cmake/cmake/-/issues/25598
+      # I need to manually set the target link option (otherwise I would have to use intel compiler)
+      configure_file (medfwrap_symbols.def.in medfwrap_symbols.def @ONLY)
+      set (DLLDEF "${CMAKE_CURRENT_BINARY_DIR}/medfwrap_symbols.def")
+      ADD_LIBRARY(medfwrap SHARED ${medfort_wrap_SOURCES})
+      target_link_options(medfwrap PRIVATE "/DEF:${DLLDEF}")
+    else ()
+      ADD_LIBRARY(medfwrap SHARED ${medfort_wrap_SOURCES})
+    endif ()
+    # Add a particular link flag for medfwrap.dll
+
     SET_TARGET_PROPERTIES(medfwrap PROPERTIES
       SOVERSION 11
       VERSION   11.1.1)
Index: src/medfwrap_symbols.def.in
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/medfwrap_symbols.def.in b/src/medfwrap_symbols.def.in
new file mode 100644
--- /dev/null	(date 1713957267158)
+++ b/src/medfwrap_symbols.def.in	(date 1713957267158)
@@ -0,0 +1,620 @@
+EXPORTS
+	EDFCHAC
+	EDFCHAE
+	EDFCHAI
+	EDFCHAL
+	EDFCONE
+	EDFCONL
+	EDFCOOE
+	EDFCOOL
+	EDFDEMO
+	EDFDIML
+	EDFELEE
+	EDFELEL
+	EDFEQUC
+	EDFEQUE
+	EDFEQUI
+	EDFEQUL
+	EDFESPC
+	EDFESPL
+	EDFEXIT
+	EDFFAMC
+	EDFFAMC231
+	EDFFAMC232
+	EDFFAME
+	EDFFAMI
+	EDFFAML
+	EDFFERM
+	EDFFIDE
+	EDFFIEN
+	EDFFOCO
+	EDFG2FC
+	EDFGAUE
+	EDFGAUI
+	EDFGAUL
+	EDFGNME
+	EDFGNML
+	EDFICOE
+	EDFICOL
+	EDFJNCO
+	EDFJNTC
+	EDFJNTE
+	EDFJNTI
+	EDFJNTL
+	EDFJTCO
+	EDFLFDE
+	EDFLIEE
+	EDFLIEI
+	EDFLIEL
+	EDFMAAC
+	EDFMAAI
+	EDFMONT
+	EDFNAGE
+	EDFNAGL
+	EDFNATT
+	EDFNCHA
+	EDFNCOR
+	EDFNEMA
+	EDFNENT
+	EDFNEQU
+	EDFNFAM
+	EDFNGAU
+	EDFNGRO
+	EDFNJNT
+	EDFNLIE
+	EDFNMAA
+	EDFNNIE
+	EDFNNIL
+	EDFNNME
+	EDFNNML
+	EDFNNSE
+	EDFNNSL
+	EDFNOEE
+	EDFNOEL
+	EDFNOME
+	EDFNOML
+	EDFNPDT
+	EDFNPFL
+	EDFNPRO
+	EDFNREF
+	EDFNSCA
+	EDFNSPD
+	EDFNUME
+	EDFNUML
+	EDFNVAL
+	EDFNVLI
+	EDFOUVR
+	EDFPDTI
+	EDFPECE
+	EDFPECL
+	EDFPFLE
+	EDFPFLL
+	EDFPGCE
+	EDFPGCL
+	EDFPROI
+	EDFPYEI
+	EDFPYGI
+	EDFREFI
+	EDFSCAC
+	EDFSCAI
+	EDFSCEE
+	EDFSCEL
+	EDFSCFE
+	EDFSCFL
+	EDFSCOE
+	EDFSCOL
+	EDFSPDI
+	EDFUNVC
+	EDFUNVL
+	EDFVECO
+	EDFVEDO
+	EDFVELI
+	EFCHAC
+	EFCHAE
+	EFCHAI
+	EFCHAL
+	EFCHIE
+	EFCHIL
+	EFCHRE
+	EFCHRL
+	EFCONE
+	EFCONL
+	EFCOOE
+	EFCOOL
+	EFDEMO
+	EFDIML
+	EFELEE
+	EFELEL
+	EFEQUC
+	EFEQUE
+	EFEQUI
+	EFEQUL
+	EFESPC
+	EFESPL
+	EFEXIT
+	EFFAMC
+	EFFAME
+	EFFAMI
+	EFFAML
+	EFFERM
+	EFFIDE
+	EFFIEN
+	EFFOCO
+	EFG2FC
+	EFGAUE
+	EFGAUI
+	EFGAUL
+	EFGNME
+	EFGNML
+	EFICOE
+	EFICOL
+	EFJNCO
+	EFJNTC
+	EFJNTE
+	EFJNTI
+	EFJNTL
+	EFJTCO
+	EFLFDE
+	EFLIEE
+	EFLIEI
+	EFLIEL
+	EFMAAC
+	EFMAAI
+	EFMONT
+	EFNAGE
+	EFNAGL
+	EFNATT
+	EFNCHA
+	EFNCOR
+	EFNEMA
+	EFNENT
+	EFNEQU
+	EFNFAM
+	EFNGAU
+	EFNGRO
+	EFNJNT
+	EFNLIE
+	EFNMAA
+	EFNNIE
+	EFNNIL
+	EFNNME
+	EFNNML
+	EFNNSE
+	EFNNSL
+	EFNOEE
+	EFNOEL
+	EFNOME
+	EFNOML
+	EFNPDT
+	EFNPFL
+	EFNPRO
+	EFNREF
+	EFNSCA
+	EFNSPD
+	EFNUME
+	EFNUML
+	EFNVAL
+	EFNVLI
+	EFOUVR
+	EFPDTI
+	EFPECE
+	EFPECL
+	EFPFLE
+	EFPFLL
+	EFPGCE
+	EFPGCL
+	EFPROI
+	EFPYEI
+	EFPYGI
+	EFREFI
+	EFSCAC
+	EFSCAI
+	EFSCEE
+	EFSCEL
+	EFSCFE
+	EFSCFL
+	EFSCOE
+	EFSCOL
+	EFSPDI
+	EFUNVC
+	EFUNVL
+	EFVECO
+	EFVEDO
+	EFVELI
+	MED_SET_IT
+	MEQCOR
+	MEQCOW
+	MEQCRE
+	MEQCSI
+	MEQCSZ
+	MEQEQI
+	MEQFCOR
+	MEQFCOW
+	MEQFCRE
+	MEQFCSI
+	MEQFCSZ
+	MEQFEQI
+	MEQFNEQ
+	MEQFSZI
+	MEQNEQ
+	MEQSZI
+	MFACRE
+	MFAFAI
+	MFAFCRE
+	MFAFFAI
+	MFAFNFA
+	MFAFNFG
+	MFAFOFI
+	MFAFONA
+	MFANFA
+	MFANFG
+	MFAOFI
+	MFAONA
+	MFDCMI
+	MFDCMW
+	MFDCRE
+	MFDCSI
+	MFDFCMI
+	MFDFCMW
+	MFDFCRE
+	MFDFCSI
+	MFDFDI
+	MFDFFDI
+	MFDFFIN
+	MFDFIAR
+	MFDFIAW
+	MFDFIN
+	MFDFINI
+	MFDFINW
+	MFDFIPR
+	MFDFIPW
+	MFDFIVR
+	MFDFIVW
+	MFDFNCN
+	MFDFNFC
+	MFDFNFD
+	MFDFNIN
+	MFDFNPF
+	MFDFNPN
+	MFDFNVA
+	MFDFNVP
+	MFDFOCI
+	MFDFOIR
+	MFDFONP
+	MFDFONV
+	MFDFORR
+	MFDFRAR
+	MFDFRAW
+	MFDFRPR
+	MFDFRPW
+	MFDFRVR
+	MFDFRVW
+	MFDIAR
+	MFDIAW
+	MFDINI
+	MFDINW
+	MFDIPR
+	MFDIPW
+	MFDIVR
+	MFDIVW
+	MFDNCN
+	MFDNFC
+	MFDNFD
+	MFDNIN
+	MFDNPF
+	MFDNPN
+	MFDNVA
+	MFDNVP
+	MFDOCI
+	MFDOIR
+	MFDONP
+	MFDONV
+	MFDORR
+	MFDRAR
+	MFDRAW
+	MFDRPR
+	MFDRPW
+	MFDRVR
+	MFDRVW
+	MFICLO
+	MFICOM
+	MFICOR
+	MFICOW
+	MFIEXI
+	MFIFCLO
+	MFIFCOM
+	MFIFCOR
+	MFIFCOW
+	MFIFEXI
+	MFIFNAM
+	MFIFNVR
+	MFIFOEX
+	MFIFOMN
+	MFIFOPE
+	MFIFOUN
+	MFIFSVR
+	MFIFVOP
+	MFINAM
+	MFINVR
+	MFIOEX
+	MFIOMN
+	MFIOPE
+	MFIOUN
+	MFISVR
+	MFIVOP
+	MFRALL
+	MFRBLC
+	MFRCRE
+	MFRDEA
+	MFRFALL
+	MFRFBLC
+	MFRFCRE
+	MFRFDEA
+	MIPBFR
+	MIPBFW
+	MIPCRE
+	MIPCSZ
+	MIPFBFR
+	MIPFBFW
+	MIPFCRE
+	MIPFCSZ
+	MIPFIIN
+	MIPFIPI
+	MIPFNIP
+	MIPIIN
+	MIPIPI
+	MIPNIP
+	MLBCLO
+	MLBFCLO
+	MLBFHNV
+	MLBFHSV
+	MLBFNUV
+	MLBFSTV
+	MLBHNV
+	MLBHSV
+	MLBNUV
+	MLBSTV
+	MLCFLCI
+	MLCFLNI
+	MLCFLOR
+	MLCFLOW
+	MLCFNLC
+	MLCLCI
+	MLCLNI
+	MLCLOR
+	MLCLOW
+	MLCNLC
+	MLNFLAI
+	MLNFLIR
+	MLNFLIW
+	MLNFLNI
+	MLNFNLN
+	MLNLAI
+	MLNLIR
+	MLNLIW
+	MLNLNI
+	MLNNLN
+	MMHAAR
+	MMHAAW
+	MMHASR
+	MMHASW
+	MMHATR
+	MMHATW
+	MMHCAR
+	MMHCAW
+	MMHCOR
+	MMHCOW
+	MMHCPR
+	MMHCPW
+	MMHCRE
+	MMHCSC
+	MMHCSI
+	MMHCSR
+	MMHCYR
+	MMHCYW
+	MMHEAR
+	MMHEAW
+	MMHELR
+	MMHELW
+	MMHENI
+	MMHENR
+	MMHENW
+	MMHFAAR
+	MMHFAAW
+	MMHFASR
+	MMHFASW
+	MMHFATR
+	MMHFATW
+	MMHFCAR
+	MMHFCAW
+	MMHFCOR
+	MMHFCOW
+	MMHFCPR
+	MMHFCPW
+	MMHFCRE
+	MMHFCSC
+	MMHFCSI
+	MMHFCSR
+	MMHFCYR
+	MMHFCYW
+	MMHFEAR
+	MMHFEAW
+	MMHFELR
+	MMHFELW
+	MMHFENI
+	MMHFENR
+	MMHFENW
+	MMHFFNR
+	MMHFFNW
+	MMHFGCR
+	MMHFGCW
+	MMHFGNR
+	MMHFGNW
+	MMHFGSR
+	MMHFGSW
+	MMHFGTR
+	MMHFGTW
+	MMHFIAR
+	MMHFIAW
+	MMHFMHI
+	MMHFMIN
+	MMHFNAN
+	MMHFNAX
+	MMHFNEP
+	MMHFNME
+	MMHFNMH
+	MMHFNOR
+	MMHFNOW
+	MMHFNR
+	MMHFNW
+	MMHFPGR
+	MMHFPGW
+	MMHFPHR
+	MMHFPHW
+	MMHFRAR
+	MMHFRAW
+	MMHFSAR
+	MMHFSAW
+	MMHFSTR
+	MMHFTFR
+	MMHFTFW
+	MMHFUNR
+	MMHFUNW
+	MMHFYAR
+	MMHFYAW
+	MMHFYPR
+	MMHFYPW
+	MMHGCR
+	MMHGCW
+	MMHGNR
+	MMHGNW
+	MMHGSR
+	MMHGSW
+	MMHGTR
+	MMHGTW
+	MMHIAR
+	MMHIAW
+	MMHMII
+	MMHMIN
+	MMHNAN
+	MMHNAX
+	MMHNEP
+	MMHNME
+	MMHNMH
+	MMHNOR
+	MMHNOW
+	MMHPGR
+	MMHPGW
+	MMHPHR
+	MMHPHW
+	MMHRAR
+	MMHRAW
+	MMHSAR
+	MMHSAW
+	MMHSTR
+	MMHTFR
+	MMHTFW
+	MMHUNR
+	MMHUNW
+	MMHYAR
+	MMHYAW
+	MMHYPR
+	MMHYPW
+	MPFFNPF
+	MPFFPFI
+	MPFFPRR
+	MPFFPRW
+	MPFFPSN
+	MPFNPF
+	MPFPFI
+	MPFPRR
+	MPFPRW
+	MPFPSN
+	MPRCRE
+	MPRCSI
+	MPRFCRE
+	MPRFCSI
+	MPRFIVR
+	MPRFIVW
+	MPRFNPR
+	MPRFPIN
+	MPRFPRI
+	MPRFRVR
+	MPRFRVW
+	MPRIVR
+	MPRIVW
+	MPRNPR
+	MPRPIN
+	MPRPRI
+	MPRRVR
+	MPRRVW
+	MSDCRR
+	MSDCRW
+	MSDCSI
+	MSDCSZ
+	MSDFCRR
+	MSDFCRW
+	MSDFCSI
+	MSDFCSZ
+	MSDFJCR
+	MSDFJNI
+	MSDFNJN
+	MSDFSZI
+	MSDJCR
+	MSDJNI
+	MSDNJN
+	MSDSZI
+	MSEASZ
+	MSECAI
+	MSECNI
+	MSECRE
+	MSEFASZ
+	MSEFCAI
+	MSEFCNI
+	MSEFCRE
+	MSEFIAR
+	MSEFIAW
+	MSEFIPW
+	MSEFNSE
+	MSEFRAR
+	MSEFRAW
+	MSEFRPW
+	MSEFSAR
+	MSEFSAW
+	MSEFSEI
+	MSEFSEN
+	MSEFSGT
+	MSEFSIN
+	MSEFSPW
+	MSEFVAC
+	MSEFVAI
+	MSEFVNI
+	MSEIAR
+	MSEIAW
+	MSEIPW
+	MSENSE
+	MSERAR
+	MSERAW
+	MSERPW
+	MSESAR
+	MSESAW
+	MSESEI
+	MSESEN
+	MSESGT
+	MSESIN
+	MSESPW
+	MSEVAC
+	MSEVAI
+	MSEVNI
+	MSMCRE
+	MSMFCRE
+	MSMFNAN
+	MSMFNAX
+	MSMFNSM
+	MSMFSMI
+	MSMFSNI
+	MSMNAN
+	MSMNAX
+	MSMNSM
+	MSMSMI
+	MSMSNI
